---
title: "Cambio de PBRs Anchoveta Centro-sur a BD50 y F55"
output: pdf_document
---

Análisis que considera el caso base cuyos PBRs son BD55% y F60% y un caso alternativo cuyos PBRs son BD50% y F55% (como PBRs de anchoveta norte). Sobre la base de los resultados de la asesoría de julio 2021.

```{r llama codigos, warning=F, include=T, message=F, echo=FALSE}
library(knitr) # para generar reporte Rmarkdown
library(stringr)
library(reshape) 
library(dplyr) 
library(ggplot2)
library(ggthemes) # para ggplot
library(patchwork) # para unir gráficos de ggplot
library(strucchange) # libreria utilizada para análisis de quiebres

dir.Fig     <-"Figuras/" # carpeta de las figuras utilizadas y generadas en este estudio
fig         <-c("pdf") # formato de figuras generadas por este código
dir.0       <-getwd() # directorio de trabajo 
dir.1       <-paste(dir.0,"/codigos_admb",sep="") # carpeta de códigos ADMB 
dir.fun     <-paste(dir.0,"/funciones/",sep="") # carpeta de funciones utilizadas en este informe
source(paste(dir.fun,"functions.R",sep="")) # funciones para leer .dat y .rep
source(paste(dir.fun,"Fn_PBRs.R",sep="")) # funciones para leer .dat y .rep
ant <-reptoRlist(paste(dir.0,"/DatosEntrada.dat",sep=""))  # datos utilizados para antecedentes

```

```{r CORRE MODELO BASE SEPTIEMBRE, eval=FALSE, echo=FALSE, warning=FALSE, include=F}
setwd(dir.1)
#Asesoría de septiembre
# para mac
system("~/admb-12.2/admb MAE0920b")
system("./MAE0920b")
#para windows
#system("admb MAE0920b")
#system("MAE0920b")

```

```{r CORRE MODELO BASE MARZO, eval=FALSE, echo=FALSE, warning=FALSE,include=F}
setwd(dir.1)
#Asesoría de septiembre
#para mac
system("~/admb-12.2/admb MAE0321b")
system("./MAE0321b")
#para windows
#system("admb MAE0321b")
#system("MAE0321b")


```

```{r CORRE MODELO BASE JULIO, eval=FALSE, echo=FALSE, warning=FALSE,include=F}
setwd(dir.1)
#Asesoría de septiembre
#para mac
system("~/admb-12.2/admb MAE0721b")
system("./MAE0721b")

```


```{r CORRE MODELO BASE JULIO_F55, eval=FALSE, echo=FALSE, warning=FALSE,include=F}
setwd(dir.1)
#Asesoría de septiembre
#para mac
system("~/admb-12.2/admb MAE0721b55")
system("./MAE0721b55")

```


```{r  leer datos, echo=FALSE, warning=FALSE,incluide=F}

setwd(dir.1)

# ASESORÍA DE SEPTIEMBRE
data1        <- lisread("MAE0920b.dat") 
names(data1) <- str_trim(names(data1), side="right")
dat1         <- data1
rep1         <- reptoRlist("MAE0920b.rep")
std1         <- read.table("MAE0920b.std",header=T,sep="",na="NA",fill=T) 

# ASESORÍA DE MARZO
data2        <- lisread("MAE0721b.dat") 
names(data2) <- str_trim(names(data2), side="right")
dat2         <- data2
rep2         <- reptoRlist("MAE0721b.rep")
std2         <- read.table("MAE0721b.std",header=T,sep="",na="NA",fill=T) 

# ASESORÍA DE JULIO
data3        <- lisread("MAE0721b55.dat") 
names(data3) <- str_trim(names(data3), side="right")
dat3         <- data3
rep3         <- reptoRlist("MAE0721b55.rep")
std3         <- read.table("MAE0721b55.std",header=T,sep="",na="NA",fill=T) 

```


```{r PRIMER PASO CBA ASESORIA SEPTIEMBRE, eval=FALSE, echo=FALSE, warning=FALSE,include=F}

source(paste(dir.fun,"Fn_CBA.R",sep=""))

CBA(dir.0,
    dir.1,
    Carpeta="/CBA_sept",
    admb="MAE0920b",
    l_opt_proy=290,
    l_opRec=293,
    l_mf=299,
    opt_proy=2,
    system="mac")


```

```{r PRIMER PASO CBA ASESORIA MARZO, eval=FALSE, echo=FALSE, warning=FALSE,include=F}

source(paste(dir.fun,"Fn_CBA.R",sep=""))

CBA(dir.0,
    dir.1,
    Carpeta="/CBA_marzo",
    admb="MAE0321b",
    l_opt_proy=297,
    l_opRec=300,
    l_mf=306,
    opt_proy=1,
    system="mac")


```

```{r PRIMER PASO CBA ASESORIA JULIO, eval=FALSE, echo=FALSE, warning=FALSE,include=F}

source(paste(dir.fun,"Fn_CBA.R",sep=""))

CBA(dir.0,
    dir.1,
    Carpeta="/CBA_julio",
    admb="MAE0721b",
    l_opt_proy=297,
    l_opRec=300,
    l_mf=306,
    opt_proy=1,
    system="mac")


```

```{r PRIMER PASO CBA ASESORIA JULIO55, eval=FALSE, echo=FALSE, warning=FALSE,include=F}

source(paste(dir.fun,"Fn_CBA.R",sep=""))

CBA(dir.0,
    dir.1,
    Carpeta="/CBA_julio55",
    admb="MAE0721b55",
    l_opt_proy=297,
    l_opRec=300,
    l_mf=306,
    opt_proy=1,
    system="mac")


```






```{r Variables_sept, echo=F,message=FALSE, warning=FALSE, include=T}

years1<-rep2$years
nyears1<-length(years1)

Rt1      <- c(subset(std1,name=="Reclutas")$value,NA) 
Rt1std   <- c(subset(std1,name=="Reclutas")$std,NA)
BT1      <- c(subset(std1,name=="BT")$value,NA)   
BT1std   <- c(subset(std1,name=="BT")$std,NA)
BD1      <- c(subset(std1,name=="SSB")$value,NA)   
BD1std   <- c(subset(std1,name=="SSB")$std,NA)
Ft1      <- c(subset(std1,name=="log_Ft")$value,NA)   
Ft1std   <- c(subset(std1,name=="log_Ft")$std,NA)

VarPobSep<- data.frame(x=years1, 
                       Rt1=Rt1,
                       BT1=BT1,
                       BD1=BD1,
                       Ft1=exp(Ft1), 
         lowerRt1 = (Rt1 -1.96*Rt1std), 
         upperRt1 = (Rt1+1.96*Rt1std),
         lowerBT1 = (BT1 -1.96*BT1std), 
         upperBT1 = (BT1+1.96*BT1std),
         lowerBD1 = (BD1 -1.96*BD1std), 
         upperBD1 = (BD1+1.96*BD1std),
         lowerFt1 = exp(Ft1 -1.96*Ft1std), 
         upperFt1 = exp(Ft1+1.96*Ft1std))

```

```{r Variables_marzo, echo=F,message=FALSE, warning=FALSE, include=T}

years2<-rep2$years
nyears2<-length(years2)

Rt2      <- subset(std2,name=="Reclutas")$value 
Rt2std   <- subset(std2,name=="Reclutas")$std
BT2      <- subset(std2,name=="BT")$value   
BT2std   <- subset(std2,name=="BT")$std
BD2      <- subset(std2,name=="SSB")$value   
BD2std   <- subset(std2,name=="SSB")$std
Ft2      <- subset(std2,name=="log_Ft")$value   
Ft2std   <- subset(std2,name=="log_Ft")$std

VarPobMar<- data.frame(x=years2, 
                       Rt2=Rt2,
                       BT2=BT2,
                       BD2=BD2,
                       Ft2=exp(Ft2), 
         lowerRt2 = (Rt2 -1.96*Rt2std), 
         upperRt2 = (Rt2+1.96*Rt2std),
         lowerBT2 = (BT2 -1.96*BT2std), 
         upperBT2 = (BT2+1.96*BT2std),
         lowerBD2 = (BD2 -1.96*BD2std), 
         upperBD2 = (BD2+1.96*BD2std),
         lowerFt2 = exp(Ft2 -1.96*Ft2std), 
         upperFt2 = exp(Ft2+1.96*Ft2std))


```

```{r Variables_julio, echo=F,message=FALSE, warning=FALSE, include=T}

years3  <- rep3$years
nyears3 <- length(years3)

Rt3      <- subset(std3,name=="Reclutas")$value 
Rt3std   <- subset(std3,name=="Reclutas")$std
BT3      <- subset(std3,name=="BT")$value   
BT3std   <- subset(std3,name=="BT")$std
BD3      <- subset(std3,name=="SSB")$value   
BD3std   <- subset(std3,name=="SSB")$std
Ft3      <- subset(std3,name=="log_Ft")$value   
Ft3std   <- subset(std3,name=="log_Ft")$std

VarPobJul<- data.frame(x=years3, 
                       Rt3=Rt3,
                       BT3=BT3,
                       BD3=BD3,
                       Ft3=exp(Ft3), 
         lowerRt3 = (Rt3 -1.96*Rt3std), 
         upperRt3 = (Rt3 +1.96*Rt3std),
         lowerBT3 = (BT3 -1.96*BT3std), 
         upperBT3 = (BT3 +1.96*BT3std),
         lowerBD3 = (BD3 -1.96*BD3std), 
         upperBD3 = (BD3 +1.96*BD3std),
         lowerFt3 = exp(Ft3 -1.96*Ft3std), 
         upperFt3 = exp(Ft3 +1.96*Ft3std))


```


```{r Fig30, echo=FALSE, message=FALSE, warning=FALSE, include=T, fig.align="center", fig.height=8,fig.width=10,fig.path=dir.Fig,dev=fig}


Rt <- ggplot() + 
    geom_line(data=VarPobJul,aes(y=Rt3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
    geom_line(data=VarPobMar,aes(y=Rt2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
    geom_ribbon(data=VarPobJul,aes(ymin=lowerRt3, ymax=upperRt3, x=x, fill = "IC"), alpha = 0.2)+
    geom_ribbon(data=VarPobMar,aes(ymin=lowerRt2, ymax=upperRt2, x=x, fill = ""), alpha = 0.2)+
    geom_hline(yintercept = mean(VarPobJul$Rt3),colour='black',lty=2) +
     annotate("text", x=2012, y=mean(VarPobJul$Rt3),label=expression("R"[promedio])) +
    labs(x = '', y = 'Reclutamientos',colour='Asesorías')  +
     scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
    scale_colour_manual("",values=c('blue','red'))+
    scale_linetype_manual(values=c("solid", "dashed"))+
    scale_fill_manual("",values=c("grey70","grey60"))+
    theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="top")

BT <- ggplot() + 
     geom_line(data=VarPobJul,aes(y=BT3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
     geom_line(data=VarPobMar,aes(y=BT2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
     geom_ribbon(data=VarPobJul,aes(ymin=lowerBT3, ymax=upperBT3, x=x, fill = ""), alpha = 0.2)+
     geom_ribbon(data=VarPobMar,aes(ymin=lowerBT2, ymax=upperBT2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(data=VarPobJul,yintercept = mean(BT3),colour='black',lty=2) +
     annotate("text", x=2012, y=mean(BT3),label=expression("BT"[promedio])) +
     labs(x = '', y = 'Biomasa total (t)',colour='Asesorías')  +
     scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
     scale_colour_manual("",values=c('blue','red'))+
     scale_linetype_manual(values=c("solid", "dashed"))+
     scale_fill_manual("",values=c("grey70","grey60"))+
     theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")

BD <- ggplot() + 
     geom_line(data=VarPobJul,aes(y=BD3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
     geom_line(data=VarPobMar,aes(y=BD2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
     geom_ribbon(data=VarPobJul,aes(ymin=lowerBD3, ymax=upperBD3, x=x, fill = "IC"), alpha = 0.2)+
     geom_ribbon(data=VarPobMar,aes(ymin=lowerBD2, ymax=upperBD2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(data=VarPobJul,yintercept = mean(BD3),colour='black',lty=2) +
     annotate("text", x=2012, y=mean(BD3),label=expression("BD"[promedio])) +
     labs(x = '', y = 'Biomasa desovante (t)',colour='Asesorías')  +
     scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
     scale_colour_manual("",values=c('blue','red'))+
     scale_linetype_manual(values=c("solid", "dashed"))+
     scale_fill_manual("",values=c("grey70","grey60"))+
     theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="top")

Ft <- ggplot() +
    geom_line(data=VarPobJul,aes(y=Ft3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
    geom_line(data=VarPobMar,aes(y=Ft2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
    geom_ribbon(data=VarPobJul,aes(ymin=lowerFt3, ymax=upperFt3, x=x, fill = ""), alpha = 0.2)+
    geom_ribbon(data=VarPobMar,aes(ymin=lowerFt2, ymax=upperFt2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(yintercept = median(VarPobJul$Ft3),colour='black',lty=2) +
     annotate("text", x=2011, y=median(VarPobJul$Ft3),label=expression("F"[mediana])) +
    labs(x = '', y = 'Mortalidad por pesca (F)',colour='Asesorías')  +
    scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
    scale_colour_manual("",values=c('blue','red'))+
    scale_linetype_manual(values=c("solid", "dashed"))+
    scale_fill_manual("",values=c("grey70","grey60"))+
    theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")

Rt/BT | (BD/Ft)


```
\pagebreak

```{=tex}
\small
\begin{center} 
\textbf{Tabla 17.}
\end{center}
\begin{center} 
\vspace{-0.2cm} Variables poblacionales  estimadas en la evaluación de julio 2021 de anchoveta de las Regiones de Valparaíso a Los Lagos, considerando caso base BD55 y F60, y caso alternativo BD50 y F55. 
\end{center}
\vspace{-0.2cm}
\footnotesize
```
```{r Tabla_28, echo=FALSE,warning=FALSE}
yearsb<-c("1996/97","1997/98","1998/99","1999/00","2000/01","2001/02","2002/03","2003/04","2004/05","2005/06","2006/07","2007/08","2008/09","2009/10","2010/11","2011/12","2012/13","2013/14","2014/15","2015/16","2016/17","2017/18","2018/19","2019/20",'2020/21')

Rt1      <- c(subset(std1,name=="Reclutas")$value,NA) 
Rt1std   <- c(subset(std1,name=="Reclutas")$std,NA)
BT1      <- c(subset(std1,name=="BT")$value,NA)   
BT1std   <- c(subset(std1,name=="BT")$std,NA)
BD1      <- c(subset(std1,name=="SSB")$value,NA)   
BD1std   <- c(subset(std1,name=="SSB")$std,NA)
Ft1      <- c(subset(std1,name=="log_Ft")$value,NA)   
Ft1std   <- c(subset(std1,name=="log_Ft")$std,NA)


Rt2      <- subset(std2,name=="Reclutas")$value 
Rt2tabla      <- rep2$Reclutas
Rt2std   <- subset(std2,name=="Reclutas")$std
BT2      <- subset(std2,name=="BT")$value  
BT2tabla      <- rep2$BT   
BT2std   <- subset(std2,name=="BT")$std
BD2      <- subset(std2,name=="SSB")$value  
BD2tabla      <- rep2$SSB  
BD2std   <- subset(std2,name=="SSB")$std
Ft2      <- subset(std2,name=="log_Ft")$value   
Ft2tabla     <- rep2$Ftot
Ft2std   <- subset(std2,name=="log_Ft")$std

Rt3std   <- subset(std3,name=="Reclutas")$value
Rt3tabla      <- rep3$Reclutas
Rt3std   <- subset(std3,name=="Reclutas")$std
BT3      <- subset(std3,name=="BT")$value   
BT3tabla      <- rep3$BT   
BT3std   <- subset(std3,name=="BT")$std
BD3      <- subset(std3,name=="SSB")$value   
BD3tabla      <- rep3$SSB   
BD3std   <- subset(std3,name=="SSB")$std
Ft3      <- subset(std3,name=="log_Ft")$value
Ft3tabla     <- rep3$Ftot
Ft3std   <- subset(std3,name=="log_Ft")$std

VarPobl1<- cbind('Año'=yearsb,
                 "$BD_{julio_{F60}}$"=c(BD2tabla),
                  "$BD_{julio_{F55}}$"=c(BD3tabla),
                 "$BT_{julio_{F60}}$"=c(BT2tabla),
                 "$BT_{julio_{F55}}$"=c(BT3tabla),
                 "$R_{julio_{F60}}$"=c(round(Rt2tabla,0)),
                 "$R_{julio_{F55}}$"=c(round(Rt3tabla,0)),
                 "$F_{julio_{F60}}$"=c(round(Ft2tabla,3)),
                 "$F_{julio_{F55}}$"=c(round((Ft3tabla),3)))
kable(VarPobl1)

#setwd(dir.basedatos)
write.csv(VarPobl1, file="Tablas/indicadoresPoblacionalesF55.csv")
#setwd(dir.1)
```


```{r Data_PBR_biologico_marzo, echo=FALSE}
#PBR año biologico
Amax        <- dat2$nedades 
Fmort 	    <- seq(0,3.5,0.02)           
nf          <- length(Fmort) 
R0 		      <- 1  
#datos de entrada 
Dat<-list()
Dat$M		    <- dat2$par[5]             
Dat$Tspw	  <- dat2$Dt[3]              
Dat$Mad	    <- dat2$madurezsexual        
Dat$Wmed	  <- colMeans(dat2$Wmed)      
Dat$Wini	  <- colMeans(dat2$Wini) 
Dat$Sel     <- rep2$S_f[1,] 

Rmed2        <- mean(Rt2)           
Bmed2        <- mean(BD2)         
Fmedian2     <- exp(median(Ft2))

Bobj        <-c(.85,.80,.60,.55,.52,.50,.45,.40,.30,.325,0.425)
Fobj      	<- optim(par=rep(0.,11),fn=SPRFpbr,method='BFGS')

SPR2 		    <- SPRFmort(Rmed2,c(0,Fobj$par,Fmedian2,rep2$Ftot[25]),Amax,Dat) 
pSPR_Fmh2    <- as.numeric(SPR2[13,4])                     # Paso 2: Cálculo de la curva SPR
pB_Fmh2      <- pSPR_Fmh2-0.05                             # Paso 3: Aproximación obtención de %BD(Fmh)
SPRcurv2 		<- SPRFmort(R0,Fmort,Amax,Dat) 
```


```{r Data_PBR_biologico_julio, echo=FALSE}
#PBR año biologico
Amax        <- dat3$nedades 
Fmort 	    <- seq(0,3.5,0.02)           
nf          <- length(Fmort) 
R0 		      <- 1  
#datos de entrada 
Dat<-list()
Dat$M		    <- dat3$par[5]             
Dat$Tspw	  <- dat3$Dt[3]              
Dat$Mad	    <- dat3$madurezsexual        
Dat$Wmed	  <- colMeans(dat3$Wmed)      
Dat$Wini	  <- colMeans(dat3$Wini) 
Dat$Sel     <- rep3$S_f[1,] 

Rmed3        <- mean(Rt3)           
Bmed3        <- mean(BD3)         
Fmedian3     <- exp(median(Ft3))

Bobj        <-c(.85,.80,.60,.55,.52,.50,.45,.40,.30,.325,0.425)
Fobj      	<- optim(par=rep(0.,11),fn=SPRFpbr,method='BFGS')

SPR3 		    <- SPRFmort(Rmed3,c(0,Fobj$par,Fmedian3,rep3$Ftot[25]),Amax,Dat) 
pSPR_Fmh3    <- as.numeric(SPR3[13,4])                     # Paso 2: Cálculo de la curva SPR
pB_Fmh3      <- pSPR_Fmh3-0.05                             # Paso 3: Aproximación obtención de %BD(Fmh)
SPRcurv3 		<- SPRFmort(R0,Fmort,Amax,Dat) 
```


```{r pbrs marzo, echo=FALSE}
# ASESORÍA DE MARZO
Bo2           <- rep2$SSBpbr[1]                         # Paso 4: Obtenci?n de Bo
BRMS2         <- rep2$SSBpbr[3]                         # Paso 5: Obtenci?n de Brms = 60%SPRo = 55%Bo
FRMS2         <- rep2$Fs[2]
BLIM2         <- Bo2*0.275                              # Paso 6: Obtenci?n de Blim = 20%Bo 
FLIM2         <- rep2$Fs[3]                             # Paso 6: Obtenci?n de Flim = 30%SPRo
SpB2          <- BD2                                  # BD serie hist?rica de evaluaci?n de stock 
SpBSE2        <- BD2std                               # desviaci?n estandar BD
ln_Fyr2       <- Ft2                                    # logaritmo de Ft
ln_FSE2       <- Ft2std                                 # logaritmo de la desviaci?n standar de Ft
```


```{r pbrs julio, echo=FALSE}
# ASESORÍA DE JULIO
Bo3           <- rep3$SSBpbr[1]                         # Paso 4: Obtenci?n de Bo
BRMS3         <- rep3$SSBpbr[3]                         # Paso 5: Obtenci?n de Brms = 60%SPRo = 55%Bo
FRMS3         <- rep3$Fs[2]
BLIM3         <- Bo3*0.25                              # Paso 6: Obtenci?n de Blim = 20%Bo 
FLIM3         <- rep3$Fs[3]                             # Paso 6: Obtenci?n de Flim = 30%SPRo
SpB3          <- BD3                                  # BD serie hist?rica de evaluaci?n de stock 
SpBSE3        <- BD3std                               # desviaci?n estandar BD
ln_Fyr3       <- Ft3                                    # logaritmo de Ft
ln_FSE3       <- Ft3std                                 # logaritmo de la desviaci?n standar de Ft
```

\pagebreak

```{r Tabla_17 PBRs, echo=FALSE,eval=T}
Tabla3.1<-rbind( "BDpromedio"=c(round(Bmed2/10^3,0),
                                round(Bmed3/10^3,0)),
                 "Fmh"=c(round(Fmedian2,2),
                         round(Fmedian3,2)), 
                 "%BDPR_Fmh"=c(pSPR_Fmh2*100,
                               pSPR_Fmh3*100), 
                 "%BDPR_F~RMS~"=c(60,
                                  55),
                 "%BD_Fmh"=c(pB_Fmh2*100,
                             pB_Fmh3*100),
                 "%BD_F~RMS~"=c(55,
                                50),
                 "BDo"=c(round(Bo2/10^3,0),
                         round(Bo3/10^3,0)),
                 "BD55%"=c(round(BRMS2/10^3,0),
                           round(BRMS3/10^3,0)),
                 "BD27.5%"=c(round(BLIM2/10^3,0),
                             round(BLIM3/10^3,0)))

colnames(Tabla3.1)<-c("Julio - F60","Julio - F55")
kable(Tabla3.1)

write.csv(Tabla3.1, file="Tablas/PBRsF55.csv")

```

```{r Fig32_PBRalt,warning=F, include=T, message=F, echo=FALSE,fig.height=4.5,fig.width=9,fig.align="center",fig.path=dir.Fig,dev=fig}

BD <- ggplot() + 
     geom_line(data=VarPobJul,aes(y=BD3, x=x, colour = "julio 2021 - F55"),linetype ="solid",  size=0.5)+
     geom_line(data=VarPobMar,aes(y=BD2, x=x, colour = "julio 2021 - F60"), linetype ="dashed", size=0.5)+
     geom_ribbon(data=VarPobJul,aes(ymin=lowerBD3, ymax=upperBD3, x=x, fill = "IC"), alpha = 0.2)+
     geom_ribbon(data=VarPobMar,aes(ymin=lowerBD2, ymax=upperBD2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(yintercept = c(BRMS3,BLIM3,Bo3,Bmed3),colour=c('green3','red','blue','black'))+
     annotate("text", x=c(rep(2012,3),2005), y=c(BRMS3,BLIM3,Bo3,Bmed3),
              label=c(expression("BD"[RMS]),expression("BD"[LIM]),expression("BD"[0]),expression("BD"[promedio]))) +
     labs(x = '', y = 'Biomasa desovante (t)',colour='Asesorías')  +
     scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
     scale_colour_manual("",values=c('blue','red'))+
     scale_linetype_manual(values=c("solid", "dashed"))+
     scale_fill_manual("",values=c("grey70","grey60"))+
     theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="top")

Ft <- ggplot() + 
    geom_line(data=VarPobJul,aes(y=Ft3, x=x, colour = "julio 2021 - F55"),linetype ="solid",  size=0.5)+
    geom_line(data=VarPobMar,aes(y=Ft2, x=x, colour = "julio 2021 - F60"),linetype ="dashed",  size=0.5)+
    geom_ribbon(data=VarPobJul,aes(ymin=lowerFt3, ymax=upperFt3, x=x, fill = "IC"), alpha = 0.2)+
    geom_ribbon(data=VarPobMar,aes(ymin=lowerFt2, ymax=upperFt2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(yintercept = c(FRMS3,median(VarPobJul$Ft3)),colour=c('green3','black')) +
     annotate("text", x=c(2011,2001), y=c(FRMS3,median(exp(ln_Fyr3)))+0.05,label=c(expression("F"[RMS]),expression("F"[mh]))) +
    labs(x = '', y = 'Mortalidad por pesca (F)',colour='Asesorías')  +
    scale_x_continuous(breaks = seq(from = 1960, to = 2022, by = 2)) +
    scale_colour_manual("",values=c('blue','red'))+
    scale_linetype_manual(values=c("solid", "dashed"))+
    scale_fill_manual("",values=c("grey70","grey60"))+
    theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")

BD + Ft


```



```{r Estatus_sept, echo=F,message=FALSE, warning=FALSE, include=T}

years1<-rep2$years
nyears1<-length(years1)
#para serie histórica
Rpr1     <- c(subset(std1,name=="RPRequ3")$value,NA); 
Rpr1std  <- c(subset(std1,name=="RPRequ3")$std,NA)
Frpr1    <- c(subset(std1,name=="Frpr")$value,NA); 
Frpr1std <- c(subset(std1,name=="Frpr")$std,NA)

EstatusSep<- data.frame(x=years1, Rpr1=Rpr1,Frpr1=Frpr1,
         lowerRpr1  = (Rpr1 - 1.96*Rpr1std ), upperRpr1   = (Rpr1 +1.96*Rpr1std ),
         lowerFrpr1 = (Frpr1 -1.96*Frpr1std), upperFrpr1 = (Frpr1 +1.96*Frpr1std))

#Para densidad de probabilidad
rprSEPT     <-subset(std1,name=="RPRequ3")$value[nyears1-1]
rprSEPTstd  <-subset(std1,name=="RPRequ3")$std[nyears1-1]
FrprSEPT    <-subset(std1,name=="Frpr")$value[nyears1-1]
FrprSEPTstd <-subset(std1,name=="Frpr")$std[nyears1-1]

# biomasa desovante vs BDrms
xbs1 <-rnorm(1000, mean = rprSEPT, sd = rprSEPTstd)
xbs  <-seq(min(xbs1),max(xbs1),0.005)
ybs  <-dnorm(xbs, mean = rprSEPT, sd =rprSEPTstd)
icbs <-qnorm(c(0.05,0.95,0.5),rprSEPT,rprSEPTstd)

# mortalidad por pesca vs Frms
xfs1 <- rnorm(1000, mean = FrprSEPT, sd = FrprSEPTstd)
xfs  <-seq(min(xfs1),max(xfs1),0.005)
yfs  <-dnorm(xfs, mean = FrprSEPT, sd =FrprSEPTstd)
icfs <-qnorm(c(0.05,0.95,0.5),FrprSEPT,FrprSEPTstd)

#distribución probabilidad
xxbs      <- c(xbs[xbs>=icbs[1]&xbs<=icbs[2]],rev(xbs[xbs>=icbs[1]&xbs<=icbs[2]]))
yybs      <- c(ybs[xbs>=icbs[1]&xbs<=icbs[2]],rep(0,length(ybs[xbs>=icbs[1]&xbs<=icbs[2]])))
xxfs      <- c(xfs[xfs>=icfs[1]&xfs<=icfs[2]],rev(xfs[xfs>=icfs[1]&xfs<=icfs[2]]))
yyfs      <- c(yfs[xfs>=icfs[1]&xfs<=icfs[2]],rep(0,length(yfs[xfs>=icfs[1]&xfs<=icfs[2]])))

densb_bs  <- data.frame(x=xxbs, y=yybs , t=rep('a', length(xxbs)), r=seq(1,length(xxbs),1))
densb_fs  <- data.frame(x=xxfs, y=yyfs , t=rep('a', length(xxfs)), r=seq(1,length(xxfs),1))

### *Probabilidad de estar bajo BRMS*
#Asesoría  #P(BD<BDrms) 
pa_sept<-pnorm(1,rprSEPT,rprSEPTstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar bajo FRMS*
#Asesoría  #P(F>Frms)
pb_sept<-1-pnorm(1,FrprSEPT,FrprSEPTstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de sobreexplotacion*
#Asesoría  #P(BD<BDrms) 
pc_sept<-pnorm(0.9,rprSEPT,rprSEPTstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de colapso*
#Asesoría  #P(BD<BDrms) 
pd_sept<-pnorm(0.5,rprSEPT,rprSEPTstd,lower.tail = TRUE,log.p = F)
### *Probailidad de sobrepesca*
#Asesoría  #P(F>Frms)
pe_sept<-1-pnorm(1.1,FrprSEPT,FrprSEPTstd,lower.tail = TRUE,log.p = F)
```

```{r Estatus_marzo, echo=F,message=FALSE, warning=FALSE, include=T}

years2<-rep2$years
nyears2<-length(years2)

#para serie histórica indicadores del estatus
Rpr2     <- subset(std2,name=="RPRequ3")$value; 
Rpr2std  <- subset(std2,name=="RPRequ3")$std
Frpr2    <- subset(std2,name=="Frpr")$value; 
Frpr2std <- subset(std2,name=="Frpr")$std

EstatusMar<- data.frame(x=years2, Rpr2=Rpr2,Frpr2=Frpr2,
         lowerRpr2  = (Rpr2 - 1.96*Rpr2std ), upperRpr2   = (Rpr2 +1.96*Rpr2std ),
         lowerFrpr2 = (Frpr2 -1.96*Frpr2std), upperFrpr2 = (Frpr2+1.96*Frpr2std))

#Para densidad de probabilidad
rprMARZO     <-subset(std2,name=="RPRequ3")$value[nyears2]
rprMARZOstd  <-subset(std2,name=="RPRequ3")$std[nyears2]
FrprMARZO    <-subset(std2,name=="Frpr")$value[nyears2]
FrprMARZOstd <-subset(std2,name=="Frpr")$std[nyears2]
# biomasa desovante vs BDrms - densidad de probabilidad
xbm1 <-rnorm(1000, mean = rprMARZO, sd = rprMARZOstd)
xbm  <-seq(min(xbm1),max(xbm1),0.005)
ybm  <-dnorm(xbm, mean = rprMARZO, sd =rprMARZOstd)
icbm <-qnorm(c(0.05,0.95,0.5),rprMARZO,rprMARZOstd)
# mortalidad por pesca vs Frms - densidad de probabilidad
xfm1 <- rnorm(1000, mean = FrprMARZO, sd = FrprMARZOstd)
xfm  <-seq(min(xfm1),max(xfm1),0.005)
yfm  <-dnorm(xfm, mean = FrprMARZO, sd =FrprMARZOstd)
icfm <-qnorm(c(0.05,0.95,0.5),FrprMARZO,FrprMARZOstd)
#distribución probabilidad
xxbm      <- c(xbm[xbm>=icbm[1]&xbm<=icbm[2]],rev(xbm[xbm>=icbm[1]&xbm<=icbm[2]]))
yybm      <- c(ybm[xbm>=icbm[1]&xbm<=icbm[2]],rep(0,length(ybm[xbm>=icbm[1]&xbm<=icbm[2]])))
xxfm      <- c(xfm[xfm>=icfm[1]&xfm<=icfm[2]],rev(xfm[xfm>=icfm[1]&xfm<=icfm[2]]))
yyfm      <- c(yfm[xfm>=icfm[1]&xfm<=icfm[2]],rep(0,length(yfm[xfm>=icfm[1]&xfm<=icfm[2]])))

densb_bm  <- data.frame(x=xxbm, y=yybm , t=rep('a', length(xxbm)), r=seq(1,length(xxbm),1))
densb_fm  <- data.frame(x=xxfm, y=yyfm , t=rep('a', length(xxfm)), r=seq(1,length(xxfm),1))


### *Probabilidad de estar bajo BRMS*
#Asesoría  #P(BD<BDrms) 
pa_mar<-pnorm(1,rprMARZO,rprMARZOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar bajo FRMS*
#Asesoría  #P(F>Frms)
pb_mar<-1-pnorm(1,FrprMARZO,FrprMARZOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de sobreexplotacion*
#Asesoría  #P(BD<BDrms) 
pc_mar<-pnorm(0.9,rprMARZO,rprMARZOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de colapso*
#Asesoría  #P(BD<BDrms) 
pd_mar<-pnorm(0.5,rprMARZO,rprMARZOstd,lower.tail = TRUE,log.p = F)
### *Probailidad de sobrepesca*
#Asesoría  #P(F>Frms)
pe_mar<-1-pnorm(1.1,FrprMARZO,FrprMARZOstd,lower.tail = TRUE,log.p = F)

```


```{r Estatus_julio, echo=F,message=FALSE, warning=FALSE, include=T}

years3  <-rep3$years
nyears3 <-length(years3)

#para serie histórica indicadores del estatus
Rpr3     <- subset(std3,name=="RPRequ3")$value; 
Rpr3std  <- subset(std3,name=="RPRequ3")$std
Frpr3    <- subset(std3,name=="Frpr")$value; 
Frpr3std <- subset(std3,name=="Frpr")$std

EstatusJul<- data.frame(x=years3, 
                        Rpr3=Rpr3,
                        Frpr3=Frpr3,
         lowerRpr3  = (Rpr3  - 1.96*Rpr3std ),
         upperRpr3  = (Rpr3  + 1.96*Rpr3std ),
         lowerFrpr3 = (Frpr3 - 1.96*Frpr3std), 
         upperFrpr3 = (Frpr3 + 1.96*Frpr3std))

#Para densidad de probabilidad
rprJULIO     <-subset(std3,name=="RPRequ3")$value[nyears3]
rprJULIOstd  <-subset(std3,name=="RPRequ3")$std[nyears3]
FrprJULIO    <-subset(std3,name=="Frpr")$value[nyears3]
FrprJULIOstd <-subset(std3,name=="Frpr")$std[nyears3]
# biomasa desovante vs BDrms - densidad de probabilidad
xbj1 <-rnorm(1000, mean = rprJULIO, sd = rprJULIOstd)
xbj  <-seq(min(xbj1),max(xbj1),0.005)
ybj  <-dnorm(xbj, mean = rprJULIO, sd =rprJULIOstd)
icbj <-qnorm(c(0.05,0.95,0.5),rprJULIO,rprJULIOstd)
# mortalidad por pesca vs Frms - densidad de probabilidad
xfj1 <- rnorm(1000, mean = FrprJULIO, sd = FrprJULIOstd)
xfj  <-seq(min(xfj1),max(xfj1),0.005)
yfj  <-dnorm(xfj, mean = FrprJULIO, sd =FrprJULIOstd)
icfj <-qnorm(c(0.05,0.95,0.5),FrprJULIO,FrprJULIOstd)
#distribución probabilidad
xxbj      <- c(xbj[xbj>=icbj[1]&xbj<=icbj[2]],rev(xbj[xbj>=icbj[1]&xbj<=icbj[2]]))
yybj      <- c(ybj[xbj>=icbj[1]&xbj<=icbj[2]],rep(0,length(ybj[xbj>=icbj[1]&xbj<=icbj[2]])))
xxfj      <- c(xfj[xfj>=icfj[1]&xfj<=icfj[2]],rev(xfj[xfj>=icfj[1]&xfj<=icfj[2]]))
yyfj      <- c(yfj[xfj>=icfj[1]&xfj<=icfj[2]],rep(0,length(yfj[xfj>=icfj[1]&xfj<=icfj[2]])))

densb_bj  <- data.frame(x=xxbj, y=yybj , t=rep('a', length(xxbj)), r=seq(1,length(xxbj),1))
densb_fj  <- data.frame(x=xxfj, y=yyfj , t=rep('a', length(xxfj)), r=seq(1,length(xxfj),1))


### *Probabilidad de estar bajo BRMS*
#Asesoría  #P(BD<BDrms) 
pa_jul<-pnorm(1,rprJULIO,rprJULIOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar bajo FRMS*
#Asesoría  #P(F>Frms)
pb_jul<-1-pnorm(1,FrprJULIO,FrprJULIOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de sobreexplotacion*
#Asesoría #P(BD<BDrms) 
pc_jul<-pnorm(0.9,rprJULIO,rprJULIOstd,lower.tail = TRUE,log.p = F)
### *Probabilidad de estar en zona de colapso*
#Asesoría #P(BD<BDrms) 
pd_jul<-pnorm(0.5,rprJULIO,rprJULIOstd,lower.tail = TRUE,log.p = F)
### *Probailidad de sobrepesca*
#Asesoría  #P(F>Frms)
pe_jul<-1-pnorm(1.1,FrprJULIO,FrprJULIOstd,lower.tail = TRUE,log.p = F)

```

```{r Fig34_PBRalt,warning=F, include=T, message=F, echo=FALSE,fig.height=6,fig.width=8,fig.align="center",fig.path=dir.Fig,dev=fig}

BD_BDrms <- ggplot() + 
     geom_line(data=EstatusJul,aes(y=Rpr3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
     geom_line(data=EstatusMar,aes(y=Rpr2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
     geom_ribbon(data=EstatusJul,aes(ymin=lowerRpr3, ymax=upperRpr3, x=x, fill = "IC"), alpha = 0.2)+
     geom_ribbon(data=EstatusMar,aes(ymin=lowerRpr2, ymax=upperRpr2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(yintercept = c(1,0.5),colour=c('green3','red'))+
     annotate("text", x=c(2012,2012), y=c(1,0.5)+0.06,
              label=c(expression("BD"[RMS]),expression("BD"[LIM]))) +
     labs(x = '', y = expression("BD/BD"[RMS]),colour='Asesorías',tag="a)")  +
     scale_x_continuous(breaks = seq(from = 1960, to = 2062, by = 2)) +
     scale_colour_manual("",values=c('blue','red'))+
     scale_linetype_manual(values=c("solid", "dashed"))+
     scale_fill_manual("",values=c("grey70","grey50"))+
     theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="top")

F_Frms <- ggplot() + 
    geom_line(data=EstatusJul,aes(y=Frpr3, x=x, colour = "julio 2021 - F55"),linetype ="solid", size=0.5)+
    geom_line(data=EstatusMar,aes(y=Frpr2, x=x, colour = "julio 2021 - F60"),linetype ="dashed", size=0.5)+
    geom_ribbon(data=EstatusJul,aes(ymin=lowerFrpr3, ymax=upperFrpr3, x=x, fill = "IC"), alpha = 0.2)+
    geom_ribbon(data=EstatusMar,aes(ymin=lowerFrpr2, ymax=upperFrpr2, x=x, fill = ""), alpha = 0.2)+
     geom_hline(yintercept = 1,colour=c('green3')) +
     annotate("text", x=2012, y=1+0.25,label=c(expression("F"[RMS]))) +
    labs(x = '', y = expression("F/F"[RMS]),colour='Asesorías',tag="c)")  +
    scale_x_continuous(breaks = seq(from = 1960, to = 2062, by = 2)) +
    scale_colour_manual("",values=c('blue','red'))+
    scale_linetype_manual(values=c("solid", "dashed"))+
    scale_fill_manual("",values=c("grey70","grey50"))+
    theme_bw(base_size=10) +
     ggtitle('')+
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")

fig_desnb<- ggplot() + lims(y=c(0,3)) +
     geom_polygon(data=densb_bj,aes(x=x, y=y, group=t,alpha=0.9),fill="gray70")+
     geom_polygon(data=densb_bm,aes(x=x, y=y, group=t,alpha=0.9),fill="gray50")+
     geom_line(aes(xbj,ybj), size=0.3,color="blue",linetype ="solid")+
     geom_line(aes(xbm,ybm), size=0.3,color="red",linetype ="dashed")+
     annotate("text", x=c(1.3,1.3), y=c(2.95,2.8),colour = c('blue',"red"), size = 2.5,
              label=c(paste("IC95%_julio2021_F55 = [",round(icbj[1],3),"-",round(icbj[2],3),"]",sep=" "),
                      paste("IC95%_julio2021_F60 = [",round(icbm[1],3),"-",round(icbm[2],3),"]",sep=" "))) +
     labs(x = expression("BD"[last]*"/BD"[RMS]), y = 'Densidad de probabilidad',tag="b)")  +
     theme_bw(base_size=10) + 
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")

fig_desnf<- ggplot() + lims(y=c(0,3.5))+
     geom_polygon(data=densb_fj,aes(x=x, y=y, group=t,alpha=0.9),fill="gray70")+
     geom_polygon(data=densb_fm,aes(x=x, y=y, group=t,alpha=0.9),fill="gray50")+
     geom_line(aes(xfj,yfj), size=0.3,color="blue",linetype ="solid")+
     geom_line(aes(xfm,yfm), size=0.3,color="red",linetype ="dashed")+
     annotate("text", x=c(0.8,0.8), y=c(3.45,3.3),colour = c('blue',"red"), size = 2.5,
              label=c(paste("IC95%_julio2021_F55 = [",round(icfj[1],3),"-",round(icfj[2],3),"]",sep=" "),
                      paste("IC95%_julio2021_F60 = [",round(icfm[1],3),"-",round(icfm[2],3),"]",sep=" "))) +
     labs(x = expression("F"[last]*"/F"[RMS]), y = 'Densidad de probabilidad',tag="d)")  +
     theme_bw(base_size=10) + 
     theme(plot.title = element_text(hjust = 0.5),legend.position="none")


 {(BD_BDrms / F_Frms)   | (fig_desnb/fig_desnf)} +  plot_layout(ncol=2,widths=c(2,1))

```



```{r Tabla_29, echo=FALSE,warning=FALSE}
yearsb<-c("1996/97","1997/98","1998/99","1999/00","2000/01","2001/02","2002/03","2003/04","2004/05","2005/06","2006/07","2007/08","2008/09","2009/10","2010/11","2011/12","2012/13","2013/14","2014/15","2015/16","2016/17","2017/18","2018/19","2019/20",'2020/21')
VarPobl2<- cbind('Años'=yearsb,
                 "$F/F_{RMS_{julioF60}}$"=c(round(exp(Ft2)/FRMS2,3)),
                 "$F/F_{RMS_{julioF55}}$"=c(round((Ft3tabla)/FRMS3,3)),
                 "$BD/BD_{RMS_{julioF60}}$"=c(round(BD2/BRMS2,3)),
                 "$BD/BD_{RMS_{julioF55}}$"=c(round(BD3tabla/BRMS3,3)))
kable(VarPobl2, align = 'c')

#setwd(dir.basedatos)
write.csv(VarPobl2, file="Tablas/indicesReduccionF55.csv")
#setwd(dir.1)
```


\pagebreak

```{=tex}
\vspace{-0.3cm}
\footnotesize
```
```{r Fig35b_PBRalt, warning=F, include=T, message=F, echo=FALSE,fig.height=4,fig.width=4,fig.align="center",fig.path=dir.Fig,dev=fig}
source(paste(dir.fun,"Fn_DiagramaFase2.R",sep=""))
name2<-"Asesoría de Julio 2021 - BD55 y F60"
years2<-rep2$years
nyears2<-length(years2)

DiagramaFase2(name2,
             years2[1:nyears2-1],
             SpB2[1:nyears2-1],
             SpBSE2[1:nyears2-1],
             ln_Fyr2[1:nyears2-1],
             ln_FSE2[1:nyears2-1],
             SpB2[nyears2],
             SpBSE2[nyears2],
             ln_Fyr2[nyears2],
             ln_FSE2[nyears2],
             FRMS2,
             BRMS2,
             BLIM2,
             FLIM2,
             color=F,
             dir.1,
             etiqueta=F,
             preliminar=T,
             completo=F)

text(c(SpB2[1]/BRMS2,
       SpB2[nyears2]/BRMS2,
       SpB2[nyears2-1]/BRMS2),
     c(exp(ln_Fyr2[1])/FRMS2-0.05,
       exp(ln_Fyr2[nyears2])/FRMS2-0.05,
       exp(ln_Fyr2[nyears2-1])/FRMS2+0.05), 
     c("1990/91","2020/21","2019/20"),cex=1.2)

```

```{r Fig35c_PBRalt, warning=F, include=T, message=F, echo=FALSE,fig.height=4,fig.width=4,fig.align="center",fig.path=dir.Fig,dev=fig}
source(paste(dir.fun,"Fn_DiagramaFase2.R",sep=""))
name3<-"Asesoría de Julio 2021 - BD50 y F55"
years3  <-rep3$years
nyears3 <-length(years3)

DiagramaFase2(name3,
             years3[1:nyears3-1],
             SpB3[1:nyears3-1],
             SpBSE3[1:nyears3-1],
             ln_Fyr3[1:nyears3-1],
             ln_FSE3[1:nyears3-1],
             SpB3[nyears3],
             SpBSE3[nyears3],
             ln_Fyr3[nyears3],
             ln_FSE3[nyears3],
             FRMS3,
             BRMS3,
             BLIM3,
             FLIM3,
             color=F,
             dir.1,
             etiqueta=F,
             preliminar=F,
             completo=T)

text(c(SpB3[1]/BRMS3,
       SpB3[nyears3]/BRMS3,
       SpB3[nyears3-1]/BRMS3),
     c(exp(ln_Fyr3[1])/FRMS3-0.05,
       exp(ln_Fyr3[nyears3])/FRMS3-0.05,
       exp(ln_Fyr3[nyears3-1])/FRMS3+0.05),
     c("1990/91","2020/21","2019/20"),cex=1.2)

```

\pagebreak

```{=tex}
\small
\begin{center} 
\textbf{Tabla 21.}
\end{center}
\begin{center} 
\vspace{-0.2cm} Puntos Biológicos de referencia (PBRs) y probabilidades de estar bajo $BD_{RMS}$ y sobre $F_{RMS}$ y en sobreexplotación, colapsado o sobrepesca. 
\end{center}
\vspace{-0.2cm}
```
```{r Tabla26, echo=FALSE}
Tabla4.1<-rbind("Año biológico"=c("2020/21","2020/21"),
                "$F_{RMS}$"=c(round(FRMS2,2),round(FRMS3,2)),
                "$BD_{RMS}$"=c(round(BRMS2/10^3,0),round(BRMS3/10^3,0)),
                "$BD_{LIM}$"=c(round(BLIM2/10^3,0),round(BLIM3/10^3,0)),
                "$p(BD_{last}<BD_{RMS})$"=round(c(pa_mar,pa_jul),2),
                "$p(F_{last}>F_{RMS})$"=round(c(pb_mar,pb_jul),2),
                "$p(sobre-explotación)$"=round(c(pc_mar,pc_jul),2),
                "$p(agotado/colapsado)$"=round(c(pd_mar,pd_jul),2),
                "$p(sobrepesca)$"=round(c(pe_mar,pe_jul),2))
colnames(Tabla4.1)<-c("Julio 2021 - BD55 y F60","Julio 2021 - BD50 y F55")
kable(Tabla4.1,align='c')

write.csv(Tabla4.1, file="Tablas/ProbabilidadesEstatusF55.csv")

```

\pagebreak


## Segunda Revisión de CBA con BD55 y F60 (Asesoría de julio) 

```{r Tabla33b_CBA,echo=FALSE,warning=FALSE,eval=T}
setwd(paste(dir.0,"/CBA_julio",sep=""))

n<-3
q       <- seq(0.1,0.5,0.1)  # niveles de riesgo (cuantiles)                                
nq      <- length(q)                                                                                   
CBA     <- matrix(ncol=nq,nrow=n)
CBAp    <- rep(0,n)
CBApstd <- rep(0,n)

buffer   <- matrix(ncol=nq,nrow=n)
descarte <- matrix(ncol=nq,nrow=n)

for(i in 1:n){
  std     <- read.table(paste("MAE0721b1",i,".std",sep=""),header=T,sep="",na="NA",fill=T) 
	CBAp[i]    <-subset(std,name=="CBA_c0")$value[1]
	CBApstd[i] <-subset(std,name=="CBA_c0")$std[1]
	for(j in 1:nq){CBA[i,j]<-qnorm(q[j],CBAp[i],CBApstd[i])}}

tCBA<-cbind(CBAp,CBApstd,CBA)
colnames(tCBA)<-c("mean","std",c('10%','20%','30%','40%','50%'))
rownames(tCBA)<-c("1997-2009","Histórico","2010-2021")
kable(t(round(tCBA,0)))
```
\vspace{-0.7cm}
```{r Tabla36_Resguardomarzo, echo=FALSE, warning=F, include=T, message=F,eval=T}
for(i in 1:n){for(j in 1:nq){	
buffer[i,j]<-round(1-CBA[i,j]/CBA[i,5],2)}}
colnames(buffer)<-c('10%','20%','30%','40%','50%')
row.names(buffer)<-c("1997-2009","Histórico","2010-2021")
kable(t(buffer))
```
\vspace{-0.7cm}
```{r Tabla37_CBAdescartemarzo, echo=FALSE, warning=F, include=T, message=F,eval=T}
for(i in 1:n){for(j in 1:nq){	
descarte[i,j]<-round(CBA[i,j]*0.98,0)}} # descarte 1% (1-0.02 = 0.98)
colnames(descarte)<-c('10%','20%','30%','40%','50%')
row.names(descarte)<-c("1997-2009","Histórico","2010-2021")
kable(t(descarte))

write.csv(rbind(t(round(tCBA,0)),t(buffer),t(descarte)), file="Tablas/2daRevisionCBAF60.csv")

```


## Segunda Revisión de CBA con BD50 y F55 (Asesoría de julio 2021)

```{r Tabla39b_CBAJulio,echo=FALSE,warning=FALSE,eval=T}
setwd(paste(dir.0,"/CBA_julio55",sep=""))

n<-3
q       <- seq(0.1,0.5,0.1)  # niveles de riesgo (cuantiles)                                
nq      <- length(q)                                                                                   
CBA     <- matrix(ncol=nq,nrow=n)
CBAp    <- rep(0,n)
CBApstd <- rep(0,n)

buffer   <- matrix(ncol=nq,nrow=n)
descarte <- matrix(ncol=nq,nrow=n)

for(i in 1:n){
  std     <- read.table(paste("MAE0721b551",i,".std",sep=""),header=T,sep="",na="NA",fill=T) 
	CBAp[i]    <-subset(std,name=="CBA_c0")$value[1]
	CBApstd[i] <-subset(std,name=="CBA_c0")$std[1]
	for(j in 1:nq){CBA[i,j]<-qnorm(q[j],CBAp[i],CBApstd[i])}}

tCBA<-cbind(CBAp,CBApstd,CBA)
colnames(tCBA)<-c("mean","std",c('10%','20%','30%','40%','50%'))
rownames(tCBA)<-c("1997-2009","Histórico","2010-2021")
kable(t(round(tCBA,0)))
```
\vspace{-0.7cm}
```{r Tabla39_ResguardoJulio, echo=FALSE, warning=F, include=T, message=F,eval=T}
for(i in 1:n){for(j in 1:nq){	
buffer[i,j]<-round(1-CBA[i,j]/CBA[i,5],2)}}
colnames(buffer)<-c('10%','20%','30%','40%','50%')
row.names(buffer)<-c("1997-2009","Histórico","2010-2021")
kable(t(buffer))
```
\vspace{-0.7cm}
```{r Tabla40_CBAdescarteJulio, echo=FALSE, warning=F, include=T, message=F,eval=T}
for(i in 1:n){for(j in 1:nq){	
descarte[i,j]<-round(CBA[i,j]*0.98,0)}} # descarte 1% (1-0.02 = 0.98)
colnames(descarte)<-c('10%','20%','30%','40%','50%')
row.names(descarte)<-c("1997-2009","Histórico","2010-2021")
kable(t(descarte))

write.csv(rbind(t(round(tCBA,0)),t(buffer),t(descarte)), file="Tablas/2daRevisionCBAF55.csv")

```

